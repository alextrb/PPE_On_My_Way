<html>
<head>
<title>CreationWayActivity.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #999999; font-weight: normal; font-style: normal; }
.s0 { color: rgb(0,0,128); font-weight: bold; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(128,128,128); font-style: italic; }
.s3 { color: rgb(0,0,255); }
.s4 { color: rgb(0,128,0); font-weight: bold; }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
CreationWayActivity.java</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">package </span><span class="s1">com.onmyway.ppe.ppe_onmyway; 
 
</span><span class="s0">import </span><span class="s1">android.Manifest; 
</span><span class="s0">import </span><span class="s1">android.app.PendingIntent; 
</span><span class="s0">import </span><span class="s1">android.app.ProgressDialog; 
</span><span class="s0">import </span><span class="s1">android.content.BroadcastReceiver; 
</span><span class="s0">import </span><span class="s1">android.content.Context; 
</span><span class="s0">import </span><span class="s1">android.content.Intent; 
</span><span class="s0">import </span><span class="s1">android.content.pm.PackageManager; 
</span><span class="s0">import </span><span class="s1">android.location.Address; 
</span><span class="s0">import </span><span class="s1">android.location.Geocoder; 
</span><span class="s0">import </span><span class="s1">android.location.Location; 
</span><span class="s0">import </span><span class="s1">android.location.LocationListener; 
</span><span class="s0">import </span><span class="s1">android.location.LocationManager; 
</span><span class="s0">import </span><span class="s1">android.os.AsyncTask; 
</span><span class="s0">import </span><span class="s1">android.os.Parcelable; 
</span><span class="s0">import </span><span class="s1">android.support.v4.app.ActivityCompat; 
</span><span class="s0">import </span><span class="s1">android.support.v7.app.AppCompatActivity; 
</span><span class="s0">import </span><span class="s1">android.os.Bundle; 
</span><span class="s0">import </span><span class="s1">android.view.View; 
</span><span class="s0">import </span><span class="s1">android.widget.Button; 
</span><span class="s0">import </span><span class="s1">android.widget.EditText; 
</span><span class="s0">import </span><span class="s1">android.widget.Toast; 
 
</span><span class="s0">import </span><span class="s1">com.google.android.gms.maps.CameraUpdate; 
</span><span class="s0">import </span><span class="s1">com.google.android.gms.maps.CameraUpdateFactory; 
</span><span class="s0">import </span><span class="s1">com.google.android.gms.maps.GoogleMap; 
</span><span class="s0">import </span><span class="s1">com.google.android.gms.maps.OnMapReadyCallback; 
</span><span class="s0">import </span><span class="s1">com.google.android.gms.maps.SupportMapFragment; 
</span><span class="s0">import </span><span class="s1">com.google.android.gms.maps.model.BitmapDescriptorFactory; 
</span><span class="s0">import </span><span class="s1">com.google.android.gms.maps.model.LatLng; 
</span><span class="s0">import </span><span class="s1">com.google.android.gms.maps.model.MarkerOptions; 
</span><span class="s0">import </span><span class="s1">com.google.android.gms.maps.model.PolylineOptions; 
 
</span><span class="s0">import </span><span class="s1">org.json.JSONArray; 
</span><span class="s0">import </span><span class="s1">org.json.JSONException; 
</span><span class="s0">import </span><span class="s1">org.json.JSONObject; 
 
</span><span class="s0">import </span><span class="s1">java.net.URL; 
</span><span class="s0">import </span><span class="s1">java.net.URLEncoder; 
</span><span class="s0">import </span><span class="s1">java.util.ArrayList; 
</span><span class="s0">import </span><span class="s1">java.util.List; 
 
</span><span class="s0">public class </span><span class="s1">CreationWayActivity </span><span class="s0">extends </span><span class="s1">AppCompatActivity </span><span class="s0">implements </span><span class="s1">LocationListener, OnMapReadyCallback, ActivityCompat.OnRequestPermissionsResultCallback{ 
 
    </span><span class="s2">//For the Intent</span><span class="s1"> 
    </span><span class="s2">//public final static List&lt;LatLng&gt; EXTRA_LIST =null;</span><span class="s1"> 
 
    </span><span class="s0">private </span><span class="s1">View mLayout; 
 
    </span><span class="s2">//map parameter</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">GoogleMap mMap; 
 
    </span><span class="s2">//current Location of the user</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">Location currentLocation; 
    </span><span class="s2">//LocationManager</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">LocationManager locationManager; 
 
    </span><span class="s2">//successive position put by the user</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">List&lt;MarkerOptions&gt; markerPositionList; 
 
    </span><span class="s2">// asking for the localisation of the user</span><span class="s1"> 
    </span><span class="s0">private static final int </span><span class="s1">LOCATION_REQUEST = </span><span class="s3">500</span><span class="s1">; 
 
    </span><span class="s2">//List of successive checkPoint</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">List&lt;LatLng&gt; checkPointList; 
 
    </span><span class="s2">//previous and new point</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">LatLng origin; 
    </span><span class="s0">private </span><span class="s1">LatLng destination; 
 
    </span><span class="s2">//Coordinate click</span><span class="s1"> 
    </span><span class="s0">private double </span><span class="s1">longitudeclick; 
    </span><span class="s0">private double </span><span class="s1">latitudeClick; 
 
    </span><span class="s2">//EditText</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">EditText editText1; 
    </span><span class="s0">private </span><span class="s1">Button buttonNext; 
    </span><span class="s0">private </span><span class="s1">Button buttonDelete; 
    </span><span class="s0">private </span><span class="s1">Button searchAddressButton; 
 
    </span><span class="s2">//geocoder</span><span class="s1"> 
    </span><span class="s0">private </span><span class="s1">Geocoder geocoder; 
 
    @Override 
    </span><span class="s0">protected void </span><span class="s1">onCreate(Bundle savedInstanceState) { 
        </span><span class="s0">super</span><span class="s1">.onCreate(savedInstanceState); 
        setContentView(R.layout.activity_creation_way); 
 
        </span><span class="s2">//initialisation of View content</span><span class="s1"> 
        buttonNext = (Button) findViewById(R.id.buttonSuivantCreation1); 
        buttonDelete = (Button) findViewById(R.id.buttonSuivantCreation1); 
        editText1 = (EditText) findViewById(R.id.editTextAddress); 
        searchAddressButton = (Button) findViewById(R.id.searchAddressButton); 
 
 
        </span><span class="s2">///////////////////////////////////////MAP PART/////////////////////////////////</span><span class="s1"> 
 
        </span><span class="s2">// Obtain the SupportMapFragment and get notified when the map is ready to be used.</span><span class="s1"> 
        SupportMapFragment mapFragment = (SupportMapFragment) getSupportFragmentManager() 
                .findFragmentById(R.id.map); 
        mapFragment.getMapAsync(</span><span class="s0">this</span><span class="s1">); 
 
        </span><span class="s2">//Initialisation of the checkPoint table and of the chekpointList</span><span class="s1"> 
        markerPositionList = </span><span class="s0">new </span><span class="s1">ArrayList&lt;&gt;(); 
        checkPointList = </span><span class="s0">new </span><span class="s1">ArrayList&lt;&gt;(); 
        System.out.println(</span><span class="s4">&quot;hey2&quot;</span><span class="s1">); 
        </span><span class="s2">// initialisation of the LocationManager</span><span class="s1"> 
        locationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE); 
 
        </span><span class="s2">//VERFICATION OF THE PERMISSION! IF NO PERMISSION, THE ACTIVITY IS NOT LAUNCH</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(ActivityCompat.checkSelfPermission(</span><span class="s0">this</span><span class="s1">, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED &amp;&amp; ActivityCompat.checkSelfPermission(</span><span class="s0">this</span><span class="s1">, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) { 
            ActivityCompat.requestPermissions(</span><span class="s0">this</span><span class="s1">, </span><span class="s0">new </span><span class="s1">String[]{Manifest.permission.ACCESS_FINE_LOCATION}, LOCATION_REQUEST); 
            </span><span class="s0">return</span><span class="s1">; 
        } 
 
        currentLocation = locationManager.getLastKnownLocation(LocationManager.NETWORK_PROVIDER); 
 
        </span><span class="s2">//initialisation of the update</span><span class="s1"> 
        Intent intent = </span><span class="s0">new </span><span class="s1">Intent(</span><span class="s0">this</span><span class="s1">, MapsActivity.GPSUpdateReceiver.</span><span class="s0">class</span><span class="s1">); 
        PendingIntent pending = PendingIntent.getBroadcast(</span><span class="s0">this</span><span class="s1">, </span><span class="s3">0</span><span class="s1">, intent, PendingIntent.FLAG_UPDATE_CURRENT); 
 
 
        </span><span class="s2">//initialisation of the map</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(mapFragment != </span><span class="s0">null</span><span class="s1">) { 
            System.out.println(</span><span class="s4">&quot;mapFrag not null&quot;</span><span class="s1">); 
            mapFragment.getMapAsync(</span><span class="s0">new </span><span class="s1">OnMapReadyCallback() { 
                @Override 
                </span><span class="s0">public void </span><span class="s1">onMapReady(GoogleMap map) { 
                    mMap = map; 
                } 
            }); 
        } </span><span class="s0">else </span><span class="s1">{ 
            Toast.makeText(</span><span class="s0">this</span><span class="s1">, </span><span class="s4">&quot;Error - Map Fragment was null!!&quot;</span><span class="s1">, Toast.LENGTH_SHORT).show(); 
        } 
 
 
    } 
 
    </span><span class="s2">///////////////////////////////////////////FUNCTION IN THE VIEW/////////////////////////////////////</span><span class="s1"> 
    </span><span class="s0">public void </span><span class="s1">delete(View view) { 
 
        </span><span class="s2">//suppression of the</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">(markerPositionList.size()&gt;=</span><span class="s3">1</span><span class="s1">){ 
            markerPositionList.remove(markerPositionList.size()-</span><span class="s3">1</span><span class="s1">); 
            checkPointList.remove(checkPointList.size()-</span><span class="s3">1</span><span class="s1">); 
        } 
        </span><span class="s2">//clean the current map</span><span class="s1"> 
        mMap.clear(); 
        </span><span class="s2">//create new marker</span><span class="s1"> 
        </span><span class="s0">for</span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">; i&lt;checkPointList.size();i++){ 
            mMap.addMarker(markerPositionList.get(i)); 
 
        } 
 
        </span><span class="s0">if</span><span class="s1">(checkPointList.size() &gt;= </span><span class="s3">2</span><span class="s1">){ 
            System.out.println(</span><span class="s4">&quot;5&quot;</span><span class="s1">); 
            </span><span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s3">1</span><span class="s1">; i &lt; checkPointList.size(); i++){ 
                origin = checkPointList.get(i-</span><span class="s3">1</span><span class="s1">); 
                destination = checkPointList.get(i); 
                mMap.addPolyline(</span><span class="s0">new </span><span class="s1">PolylineOptions().add( 
                        origin, 
                        destination 
                )); 
            } 
 
        } 
 
    } 
 
    </span><span class="s0">public void </span><span class="s1">next(View view) { 
 
        </span><span class="s0">if</span><span class="s1">(checkPointList.size()&gt;=</span><span class="s3">2</span><span class="s1">){ 
            System.out.println(</span><span class="s4">&quot;1 intent&quot;</span><span class="s1">); 
            Intent intent = </span><span class="s0">new </span><span class="s1">Intent(</span><span class="s0">this</span><span class="s1">,CreationWayActivityStep2.</span><span class="s0">class</span><span class="s1">); 
            System.out.println(</span><span class="s4">&quot;2 intent&quot;</span><span class="s1">); 
            </span><span class="s2">//intent.putExtra(&quot;EXTRA_SIZE&quot;, checkPointList.size());</span><span class="s1"> 
            intent.putParcelableArrayListExtra(</span><span class="s4">&quot;EXTRA_LIST&quot;</span><span class="s1">, (ArrayList&lt;? </span><span class="s0">extends </span><span class="s1">Parcelable&gt;) checkPointList); 
            System.out.println(</span><span class="s4">&quot;3 intent&quot;</span><span class="s1">); 
            startActivity(intent); 
        } 
 
    } 
 
    </span><span class="s0">public void </span><span class="s1">searchCoord(View view) { 
 
        </span><span class="s0">if</span><span class="s1">(!editText1.equals(</span><span class="s4">&quot;&quot;</span><span class="s1">)){ 
            </span><span class="s0">new </span><span class="s1">GetCoordinate().execute(); 
        } 
 
    } 
 
    </span><span class="s2">/////////////////////////////////////////END FUNCTION VIEW////////////////////////////////////////////</span><span class="s1"> 
 
    </span><span class="s0">public class </span><span class="s1">GPSUpdateReceiver </span><span class="s0">extends </span><span class="s1">BroadcastReceiver { 
        @Override 
        </span><span class="s0">public void </span><span class="s1">onReceive(Context context, Intent intent) { 
            Location location = (Location)intent.getParcelableExtra(LocationManager.KEY_LOCATION_CHANGED); 
        } 
    } 
 
 
    </span><span class="s2">/** 
     * Manipulates the map once available. 
     * This callback is triggered when the map is ready to be used. 
     * This is where we can add markers or lines, add listeners or move the camera. In this case, 
     * we just add a marker near Sydney, Australia. 
     * If Google Play services is not installed on the device, the user will be prompted to install 
     * it inside the SupportMapFragment. This method will only be triggered once the user has 
     * installed Google Play services and returned to the app. 
     */</span><span class="s1"> 
    @Override 
    </span><span class="s0">public void </span><span class="s1">onMapReady(GoogleMap googleMap) { 
        mMap = googleMap; 
 
        </span><span class="s2">// enable the zoom functionality</span><span class="s1"> 
        mMap.getUiSettings().setZoomControlsEnabled(</span><span class="s0">true</span><span class="s1">); 
        mMap.getMaxZoomLevel(); 
 
        </span><span class="s2">//for the initialisation of the map</span><span class="s1"> 
        </span><span class="s0">if</span><span class="s1">(currentLocation !=</span><span class="s0">null</span><span class="s1">){ 
            LatLng latLng = </span><span class="s0">new </span><span class="s1">LatLng(currentLocation.getLatitude(), currentLocation.getLongitude()); 
            </span><span class="s2">// Zoom on the current position of the user</span><span class="s1"> 
            CameraUpdate cameraUpdate = CameraUpdateFactory.newLatLngZoom(latLng, </span><span class="s3">17</span><span class="s1">); 
            mMap.animateCamera(cameraUpdate); 
        } 
 
 
        </span><span class="s2">// Current location</span><span class="s1"> 
        LatLng currentLatLong = </span><span class="s0">new </span><span class="s1">LatLng(currentLocation.getLatitude(), currentLocation.getLongitude()); 
        </span><span class="s2">//MarkerOptions markerUserPosition = new MarkerOptions();</span><span class="s1"> 
        </span><span class="s2">//markerUserPosition.position(currentLatLong);</span><span class="s1"> 
        </span><span class="s2">//marker that we can modify with the profil picture maybe</span><span class="s1"> 
        </span><span class="s2">//markerUserPosition.icon(BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_BLUE));</span><span class="s1"> 
        </span><span class="s2">//mMap.moveCamera(CameraUpdateFactory.newLatLng(currentLatLong));</span><span class="s1"> 
        </span><span class="s2">//mMap.addMarker(markerUserPosition);</span><span class="s1"> 
 
        mMap.setOnMapLongClickListener(</span><span class="s0">new </span><span class="s1">GoogleMap.OnMapLongClickListener() { 
            @Override 
            </span><span class="s0">public void </span><span class="s1">onMapLongClick(LatLng latLng) { 
 
                longitudeclick = latLng.latitude; 
                latitudeClick =latLng.longitude; 
 
                </span><span class="s2">//Part for the set text</span><span class="s1"> 
                </span><span class="s0">new </span><span class="s1">GetAddress().execute(String.format(</span><span class="s4">&quot;%.4f,%.4f&quot;</span><span class="s1">,latitudeClick,longitudeclick)); 
 
                System.out.println(</span><span class="s4">&quot;latLng.latitude&quot; </span><span class="s1">+ latitudeClick); 
                System.out.println(</span><span class="s4">&quot;latLng.lng&quot; </span><span class="s1">+ longitudeclick); 
 
                </span><span class="s2">//Reset the marker when already 2</span><span class="s1"> 
                </span><span class="s2">//mMap.clear();</span><span class="s1"> 
                MarkerOptions markerOptions = </span><span class="s0">new </span><span class="s1">MarkerOptions(); 
                markerOptions.position(latLng); 
 
                System.out.println(</span><span class="s4">&quot;1&quot;</span><span class="s1">); 
 
                </span><span class="s0">boolean </span><span class="s1">find = </span><span class="s0">false</span><span class="s1">; 
                </span><span class="s2">// If the List of marker is empty</span><span class="s1"> 
                </span><span class="s0">if</span><span class="s1">(checkPointList.size()==</span><span class="s3">0</span><span class="s1">){ 
                    </span><span class="s2">//if tables are empty</span><span class="s1"> 
                    checkPointList.add(latLng); 
                    markerPositionList.add(markerOptions); 
 
                }</span><span class="s0">else</span><span class="s1">{ 
                    </span><span class="s0">for</span><span class="s1">(</span><span class="s0">int </span><span class="s1">i=</span><span class="s3">0</span><span class="s1">; i &lt; checkPointList.size(); i++){ 
                        System.out.println(</span><span class="s4">&quot;2&quot;</span><span class="s1">); 
 
                        System.out.println(</span><span class="s4">&quot;checkPointList.get(i) &quot; </span><span class="s1">+ checkPointList.get(i)); 
                        System.out.println(</span><span class="s4">&quot;latLng &quot; </span><span class="s1">+ latLng); 
 
                        </span><span class="s2">// a refaire pour enlever le bouton delete</span><span class="s1"> 
                        </span><span class="s0">if </span><span class="s1">(checkPointList.get(i).equals(latLng)){ 
                            System.out.println(</span><span class="s4">&quot;click on a exiting coord&quot;</span><span class="s1">); 
                            checkPointList.remove(i); 
                            markerPositionList.remove(i); 
                            find = </span><span class="s0">true</span><span class="s1">; 
                        } 
                    } 
                    </span><span class="s0">if </span><span class="s1">(find==</span><span class="s0">false</span><span class="s1">){ 
                        </span><span class="s2">//add the chekPoint to the list of checkPoint</span><span class="s1"> 
                        checkPointList.add(latLng); 
                        markerPositionList.add(markerOptions); 
 
 
                    } 
                } 
 
                System.out.println(</span><span class="s4">&quot;3&quot;</span><span class="s1">); 
 
                </span><span class="s2">// it put a red marker on the map</span><span class="s1"> 
                markerOptions.icon(BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_GREEN)); 
 
                </span><span class="s2">// We remove all previous maker and we add the new one</span><span class="s1"> 
                mMap.clear(); 
                </span><span class="s0">for</span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">; i&lt;checkPointList.size();i++){ 
                    mMap.addMarker(markerPositionList.get(i)); 
 
                } 
 
                System.out.println(</span><span class="s4">&quot;4&quot;</span><span class="s1">); 
 
                </span><span class="s0">if</span><span class="s1">(checkPointList.size() &gt;= </span><span class="s3">2</span><span class="s1">){ 
                    System.out.println(</span><span class="s4">&quot;5&quot;</span><span class="s1">); 
                    </span><span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s3">1</span><span class="s1">; i &lt; checkPointList.size(); i++){ 
                        origin = checkPointList.get(i-</span><span class="s3">1</span><span class="s1">); 
                        destination = checkPointList.get(i); 
                        mMap.addPolyline(</span><span class="s0">new </span><span class="s1">PolylineOptions().add( 
                                origin, 
                                destination 
                        )); 
                    } 
 
                } 
                System.out.println(</span><span class="s4">&quot;6&quot;</span><span class="s1">); 
 
                </span><span class="s2">//add to the list checkPointList</span><span class="s1"> 
 
            } 
        }); 
        </span><span class="s2">//markerUserPosition.icon(BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_BLUE));</span><span class="s1"> 
 
 
    } 
 
    </span><span class="s2">// TO RETRIEVE THE ADDRESS WHEN WE CLICK ON THE MAP</span><span class="s1"> 
 
    </span><span class="s0">private class </span><span class="s1">GetAddress </span><span class="s0">extends </span><span class="s1">AsyncTask&lt;String,Void,String&gt; { 
        ProgressDialog dialog = </span><span class="s0">new </span><span class="s1">ProgressDialog(CreationWayActivity.</span><span class="s0">this</span><span class="s1">); 
 
        @Override 
        </span><span class="s0">protected void </span><span class="s1">onPreExecute(){ 
            </span><span class="s0">super</span><span class="s1">.onPreExecute(); 
            dialog.setMessage(</span><span class="s4">&quot;Please wait ....&quot;</span><span class="s1">); 
            dialog.setCanceledOnTouchOutside(</span><span class="s0">false</span><span class="s1">); 
            dialog.show(); 
        } 
 
        @Override 
        </span><span class="s0">protected </span><span class="s1">String doInBackground(String... strings) { 
            String response; 
            </span><span class="s0">try</span><span class="s1">{ 
 
                </span><span class="s0">double </span><span class="s1">lat = latitudeClick; 
                String lat2 = String.format(</span><span class="s4">&quot;%.4f&quot;</span><span class="s1">, lat); 
                </span><span class="s0">double </span><span class="s1">lng = longitudeclick; 
                String lng2 = String.format(</span><span class="s4">&quot;%.4f&quot;</span><span class="s1">, lng); 
                </span><span class="s0">double </span><span class="s1">latfinal = Double.parseDouble(lat2.replace(</span><span class="s4">','</span><span class="s1">,</span><span class="s4">'.'</span><span class="s1">)); 
                </span><span class="s0">double </span><span class="s1">lngfinal = Double.parseDouble(lng2.replace(</span><span class="s4">','</span><span class="s1">,</span><span class="s4">'.'</span><span class="s1">)); 
 
                System.out.println(</span><span class="s4">&quot;yo1&quot; </span><span class="s1">+ latfinal); 
                System.out.println(</span><span class="s4">&quot;yo2 &quot; </span><span class="s1">+lngfinal); 
 
 
                HttpDataHandler http = </span><span class="s0">new </span><span class="s1">HttpDataHandler(); 
                String url = String.format(</span><span class="s4">&quot;https://maps.googleapis.com/maps/api/geocode/json?latlng=&quot;</span><span class="s1">+lngfinal+</span><span class="s4">&quot;,&quot;</span><span class="s1">+latfinal+</span><span class="s4">&quot;&amp;sensor=false&quot;</span><span class="s1">); 
                </span><span class="s2">//String url = &quot;https://maps.googleapis.com/maps/api/geocode/json?latlng=37.7416,-122.4796&quot;;</span><span class="s1"> 
                System.out.println(</span><span class="s4">&quot;URL:&quot; </span><span class="s1">+ url); 
                response = http.GetHTTPData(url); 
                </span><span class="s0">return </span><span class="s1">response; 
            }</span><span class="s0">catch </span><span class="s1">(Exception e){ 
                </span><span class="s2">//</span><span class="s1"> 
            } 
            </span><span class="s0">return null</span><span class="s1">; 
        } 
 
        @Override 
        </span><span class="s0">protected void </span><span class="s1">onPostExecute(String s) { 
            </span><span class="s0">try</span><span class="s1">{ 
                JSONObject jsonObject = </span><span class="s0">new </span><span class="s1">JSONObject(s); 
                String address = ((JSONArray) jsonObject.get(</span><span class="s4">&quot;results&quot;</span><span class="s1">)).getJSONObject(</span><span class="s3">0</span><span class="s1">).get(</span><span class="s4">&quot;formatted_address&quot;</span><span class="s1">).toString(); 
                editText1.setText(address); 
                System.out.println(</span><span class="s4">&quot;RESULT =&quot; </span><span class="s1">+ address); 
            }</span><span class="s0">catch </span><span class="s1">(JSONException e){ 
                e.printStackTrace(); 
            } 
            </span><span class="s0">if</span><span class="s1">(dialog.isShowing()){ 
                dialog.dismiss(); 
            } 
        } 
    } 
 
    </span><span class="s2">// TO RETRIEVE THE COORDINATE WHEN WE ENTER AN ADDRESS IN THE EDITTEXT</span><span class="s1"> 
 
    </span><span class="s0">private class </span><span class="s1">GetCoordinate </span><span class="s0">extends </span><span class="s1">AsyncTask&lt;String,Void,String&gt; { 
        ProgressDialog dialog = </span><span class="s0">new </span><span class="s1">ProgressDialog(CreationWayActivity.</span><span class="s0">this</span><span class="s1">); 
 
        @Override 
        </span><span class="s0">protected void </span><span class="s1">onPreExecute(){ 
            </span><span class="s0">super</span><span class="s1">.onPreExecute(); 
            dialog.setMessage(</span><span class="s4">&quot;Please wait ....&quot;</span><span class="s1">); 
            dialog.setCanceledOnTouchOutside(</span><span class="s0">false</span><span class="s1">); 
            dialog.show(); 
        } 
 
        @Override 
        </span><span class="s0">protected </span><span class="s1">String doInBackground(String... strings) { 
            String response; 
            </span><span class="s0">try</span><span class="s1">{ 
                String address = editText1.getText().toString(); 
 
                HttpDataHandler http = </span><span class="s0">new </span><span class="s1">HttpDataHandler(); 
                String url = String.format(</span><span class="s4">&quot;https://maps.googleapis.com/maps/api/geocode/json?address=&quot;</span><span class="s1">+ URLEncoder.encode(address)+</span><span class="s4">&quot;&amp;sensor=false&quot;</span><span class="s1">); 
                System.out.println(</span><span class="s4">&quot;URL:&quot; </span><span class="s1">+ url); 
                response = http.GetHTTPData(url); 
                System.out.println(</span><span class="s4">&quot;response = &quot; </span><span class="s1">+ response); 
                </span><span class="s0">return </span><span class="s1">response; 
            }</span><span class="s0">catch </span><span class="s1">(Exception e){ 
                </span><span class="s2">//</span><span class="s1"> 
            } 
            </span><span class="s0">return null</span><span class="s1">; 
        } 
 
        @Override 
        </span><span class="s0">protected void </span><span class="s1">onPostExecute(String s) { 
            </span><span class="s0">try</span><span class="s1">{ 
                JSONObject jsonObject = </span><span class="s0">new </span><span class="s1">JSONObject(s); 
                String latitudeSearch = ((JSONArray) jsonObject.get(</span><span class="s4">&quot;results&quot;</span><span class="s1">)).getJSONObject(</span><span class="s3">0</span><span class="s1">).getJSONObject(</span><span class="s4">&quot;geometry&quot;</span><span class="s1">).getJSONObject(</span><span class="s4">&quot;location&quot;</span><span class="s1">).get(</span><span class="s4">&quot;lat&quot;</span><span class="s1">).toString(); 
                String longitudeSearch = ((JSONArray) jsonObject.get(</span><span class="s4">&quot;results&quot;</span><span class="s1">)).getJSONObject(</span><span class="s3">0</span><span class="s1">).getJSONObject(</span><span class="s4">&quot;geometry&quot;</span><span class="s1">).getJSONObject(</span><span class="s4">&quot;location&quot;</span><span class="s1">).get(</span><span class="s4">&quot;lng&quot;</span><span class="s1">).toString(); 
 
                System.out.println(</span><span class="s4">&quot;latitude : &quot; </span><span class="s1">+ latitudeSearch); 
                System.out.println(</span><span class="s4">&quot;longitude : &quot; </span><span class="s1">+ longitudeSearch); 
 
                </span><span class="s0">double </span><span class="s1">lat = Double.parseDouble(latitudeSearch); 
                </span><span class="s0">double </span><span class="s1">lng = Double.parseDouble(longitudeSearch); 
 
                </span><span class="s2">//update of the camera</span><span class="s1"> 
                LatLng coordinateLatLng = </span><span class="s0">new </span><span class="s1">LatLng(lat,lng); 
                CameraUpdate cameraUpdate = CameraUpdateFactory.newLatLngZoom(coordinateLatLng, </span><span class="s3">17</span><span class="s1">); 
                mMap.animateCamera(cameraUpdate); 
 
            }</span><span class="s0">catch </span><span class="s1">(JSONException e){ 
                e.printStackTrace(); 
            } 
            </span><span class="s0">if</span><span class="s1">(dialog.isShowing()){ 
                dialog.dismiss(); 
            } 
        } 
    } 
 
 
    @Override 
    </span><span class="s0">public void </span><span class="s1">onLocationChanged(Location location) { 
 
    } 
 
    @Override 
    </span><span class="s0">public void </span><span class="s1">onStatusChanged(String provider, </span><span class="s0">int </span><span class="s1">status, Bundle extras) { 
 
    } 
 
    @Override 
    </span><span class="s0">public void </span><span class="s1">onProviderEnabled(String provider) { 
        Toast.makeText(</span><span class="s0">this</span><span class="s1">, </span><span class="s4">&quot;Enable new provider&quot; </span><span class="s1">+ provider, Toast.LENGTH_SHORT).show(); 
    } 
 
    @Override 
    </span><span class="s0">public void </span><span class="s1">onProviderDisabled(String provider) { 
        Toast.makeText(</span><span class="s0">this</span><span class="s1">, </span><span class="s4">&quot;disable new provider&quot; </span><span class="s1">+ provider, Toast.LENGTH_SHORT).show(); 
    } 
 
 
    </span><span class="s2">// PART FOR THE PERMISSION OF THE USER</span><span class="s1"> 
 
    @Override 
    </span><span class="s0">protected void </span><span class="s1">onResume() { 
        </span><span class="s0">super</span><span class="s1">.onResume(); 
        </span><span class="s0">if </span><span class="s1">(ActivityCompat.checkSelfPermission(</span><span class="s0">this</span><span class="s1">, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED &amp;&amp; ActivityCompat.checkSelfPermission(</span><span class="s0">this</span><span class="s1">, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) { 
            </span><span class="s2">// TODO: Consider calling</span><span class="s1"> 
            </span><span class="s2">//    ActivityCompat#requestPermissions</span><span class="s1"> 
            </span><span class="s2">// here to request the missing permissions, and then overriding</span><span class="s1"> 
            </span><span class="s2">//   public void onRequestPermissionsResult(int requestCode, String[] permissions,</span><span class="s1"> 
            </span><span class="s2">//                                          int[] grantResults)</span><span class="s1"> 
            </span><span class="s2">// to handle the case where the user grants the permission. See the documentation</span><span class="s1"> 
            </span><span class="s2">// for ActivityCompat#requestPermissions for more details.</span><span class="s1"> 
            </span><span class="s0">return</span><span class="s1">; 
        } 
        locationManager.requestLocationUpdates(LocationManager.NETWORK_PROVIDER, </span><span class="s3">400</span><span class="s1">, </span><span class="s3">1</span><span class="s1">, </span><span class="s0">this</span><span class="s1">); 
 
    } 
 
    @Override 
    </span><span class="s0">public void </span><span class="s1">onRequestPermissionsResult(</span><span class="s0">int </span><span class="s1">requestCode, String[] permission, </span><span class="s0">int</span><span class="s1">[] grantResults) { 
 
        System.out.println(</span><span class="s4">&quot;DEBUT DU ON PERMISSION&quot;</span><span class="s1">); 
        </span><span class="s0">if </span><span class="s1">(requestCode== LOCATION_REQUEST){ 
 
            </span><span class="s0">if </span><span class="s1">(grantResults.length &gt; </span><span class="s3">0 </span><span class="s1">&amp;&amp; grantResults[</span><span class="s3">0</span><span class="s1">] == PackageManager.PERMISSION_GRANTED) { 
                </span><span class="s2">// NOW WE HAVE TO LAUNCH THE ACTIVITY</span><span class="s1"> 
                startApp(); 
 
            }</span><span class="s0">else</span><span class="s1">{ 
                Toast.makeText(getApplicationContext(), </span><span class="s4">&quot;No localisation permission&quot;</span><span class="s1">, Toast.LENGTH_LONG).show(); 
            } 
        } 
 
    } 
 
    </span><span class="s0">private void </span><span class="s1">startApp(){ 
        Intent intent = </span><span class="s0">new </span><span class="s1">Intent(</span><span class="s0">this</span><span class="s1">, CreationWayActivity.</span><span class="s0">class</span><span class="s1">); 
        startActivity(intent); 
    } 
 
 
 
 
} 
</span></pre>
</body>
</html>